title: 手把手教你构建 C 语言编译器（4）- 词法分析器
date: 2015-12-29 20:54:12
tags: [C, compiler]
categories: Project
toc:
---

本章我们要讲解如何构建词法分析器。

# 什么是词法分析器

简而言之，词法分析器用于对源码字符串做预处理，以减少语法分析器的复杂程度。

词法分析器以源码字符串为输入，输出为标记流（token stream），即一连串的标记，每
个标记通常包括： `(token, token value)` 即标记本身和标记的值。例如，源码中若包
含一个数字 `'998'` ，词法分析器将输出 `(Number, 998)`，即（数字，998）。再例
如：

```
2 + 3 * (4 - 5)
=>
(Number, 2) Add (Number, 3) Multiply Left-Bracket (Number, 4) Subtract (Number, 5) Right-Bracket
```

通过词法分析器的预处理，语法分析器的复杂度会大大降低，这点在后面的语法分析器我
们就能体会。

# 词法分析器与编译器

要是深入词法分析器，你就会发现，它的本质上也是编译器。我们的编译器是以标记流为
输入，输出汇编代码，而词法分析器则是以源码字符串为输入，输出标记流。

```
                   +-------+                      +--------+
-- source code --> | lexer | --> token stream --> | parser | --> assembly
                   +-------+                      +--------+
```

在这个前提下，我们可以这样认为：直接从源代码编译成汇编代码是很困难的，因为输入
的字符串比较难处理。所以我们先编写一个较为简单的编译器（词法分析器）来将字符串
转换成标记流，而标记流对于语法分析器而言就容易处理得多了。

# 词法分析器的实现

由于词法分析的工作很常见，但又枯燥且容易出错，所以人们已经开发出了许多工具来
生成词法分析器，如 `lex, flex`。这些工具允许我们通过正则表达式来识别标记。

这里注意的是，我们并不会一次性地将所有源码全部转换成标记流，原因有二：

1. 字符串转换成标记流有时是有状态的，即与代码的上下文是有关系的。
2. 保存所有的标记流没有意义且浪费空间。

所以实际的处理方法是提供一个函数（即前几篇中提到的 `next()`），每次调用该函数
则返回下一个标记。


